<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>TopCoder TCO19 SRM 760 - 1000: ComponentsForever</title>
    
    <link type="image/x-icon" rel="shortcut icon" href="http://www.topcoder.com/i/favicon.ico"/>
    

    
    <style type="text/css">
        /* font */
body {
    font-family: Helvetica, Arial, Verdana, sans-serif;
    font-size: 16px;
    line-height: 1.2em;
}
ul.constraints > li:before, ul.notes > li:before {
    font-family: monospace;
    font-weight: normal;
}
.heading {
    font-weight: bold;
    font-size: 175%;
    line-height: 1.2em;
}
.section .section-title {
    font-weight: bold;
    font-size: 125%;
}
ol.testcases > li:before {
    font-family: monospace;
}
type {
    font-weight: bold;
    font-family: monospace;
}
li.testcase .data {
    font-family: monospace;
    line-height: 1.5em;
}

/* layout */
.heading {
    margin-top: 0.1em;
    margin-bottom:0.1em;
    text-align: center;
}
.section .section-title {
    margin-top : 1em;
    margin-bottom: 1em;
}
.problem-intro, note, user-constraint {
    padding-left: 1.25em;
}

/* Lists */
ul.constraints, ul.notes, ul.variables, ul.problem-definition-lines {
    list-style-type: none;
    padding: 0px;
}
ul.constraints > li:before {
    content: "-";
    position:relative;
    margin-left: 0px; /* optional, for multiline li element */
    left: 0.625em;
}
ul.notes > li:before {
    content: "-";
    position:relative;
    margin-left: 0px; /* optional, for multiline li element */
    left: 0.625em;
}

/* Testcases */
li.testcase {
    line-height: 1.1em;
    padding-top: 0.625em;
    padding-bottom: 0.625em;
    overflow: auto;
}
li.testcase > .testcase-content > div { padding-bottom: 0.5em; padding-left: 1em; }

li.testcase .testcase-comment {
    margin: 0;
    padding-left: 1em;
}
.testcase-comment p:first-child { margin-top: 0; }
.testcase-comment p:last-child { margin-bottom: 0; }

li.testcase .testcase-content {
    margin: 0.31em;
}

/* Data and variables */
.testcase-output {
    padding: 0.2em 1em 0.2em 0em;
}
.variables, .testcase-output {
    margin-left: 0.5em;
    display: table;
    margin-bottom: 0px;
    margin-top: 0px;
}
.variable {
    display: table-row;
}
.variable .name {
    padding: 0.2em 0em 0.2em 1em;
    font-weight: bold;
    display: table-cell;
    text-align: right;
}
.testcase-output .prefix {
    padding: 0.2em 0em 0.2em 1em;
    display: table-cell;
}
.testcase-output .prefix:after {
    content : ":";
    padding-right: 0.5em;
}
.variable .name:after {
    font-weight: bold;
    content : ":";
    padding-right: 0.5em;
}
.variable .value, .testcase-output .value {
    padding: 0.2em 1em 0.2em 0em;
    display: table-cell;
}
ol.testcases {
    padding: 0px;
    counter-reset: test_number -1;
}
ol.testcases > li {
    list-style:none;
}
ol.testcases > li:before {
    counter-increment:test_number;
    display: block;
    clear: both;
    content:counter(test_number) ")";
    color: inherit;
    background: inherit;
}

/* Problem Definition */
.problem-definition, .problem-limits {
    padding-left: 1.25em;
}
.problem-definition-lines, .limit-lines {
    display: table;
    margin-top: 0px;
    margin-bottom: 0px;
    padding-left: 0px;
}
.definition-line, .limit-line {
    display: table-row;
    height: 1.5em;
    overflow: auto;
}
.limit-name:after {
    content: ":";
    margin-right: 1em;
}
.definition-name, .definition-value, .limit-name, .limit-value {
    display: table-cell;
}
.definition-value {
    padding-left: 0.5em;
}
.definition-name:after {
    content: ":";
}
#contest-division:before {
    content: "Div ";
}
#problem-score:before {
    content: "- Problem ";
}
#problem-name {
    display: block;
}

/* Tags, hidden default */
.tag {
    visibility: hidden;
    position: absolute;
}

        body {
    /* font color */
    color: #CCCCCC;
    /* background color */
    background-color: #333333;
}
.section .section-title {
    /* title color */
    color: white;
}
li.testcase .data {
    /* highlight color */
    background: #303030;
}

    </style>
    
    
    

</head>

<body>
    <h1 class="heading">
        <span id='contest-name'>TCO19 SRM 760</span>
        
        <span id='problem-score'>1000</span>
        <span id='problem-name'>ComponentsForever</span>
    </h1>

    <hr />

    <!-- Problem Statement -->
    <div class="section">
        <h2 class="section-title">Problem Statement</h2>
        <div class="problem-intro">
            <intro escaped="1"><p><i>
This problem has a non-standard time limit of 5 seconds.
</i></p>
<p>
A community of <b>n</b> frogs lives in a pond.
The frogs are numbered 0 through <b>n</b>-1.
Frog i lives at coordinates (X[i], Y[i]).
Use the following pseudocode to generate these coordinates:
</p>
<pre>
for i = 0 .. len(Xprefix)-1:
    X[i] = Xprefix[i]
    Y[i] = Yprefix[i]

state = seed

for i = len(Xprefix) .. n-1:
    state = (1103515245 * state + 12345)
    X[i] = state modulo Xrange
    state = state modulo 2^31
    state = (1103515245 * state + 12345)
    Y[i] = state modulo Yrange
    state = state modulo 2^31
</pre>

<p>
A hop is a move in which each coordinate of a frog changes by +1 or -1.
In other words, in a hop a frog can move from its current location to any of the four diagonally adjacent locations.
</p>

<p>
Each frog has a walkie-talkie.
There are two integers L &lt; R that describe their range.
Two frogs can communicate using their walkie-talkies if and only if there is some X in the closed interval [L,R] such that one frog can reach the other by making exactly X hops.
Note that X does not have to be the <i>smallest possible</i> number of hops between the two frogs.
</p>

<p>
A new frog named Manish recently visited this pond.
Manish is an experienced politician.
Ideally, he would want to make each frog a different promise.
However, Manish knows that some frogs can communicate, and he cannot make different promises to two frogs who can talk to each other.
Let P(L,R) be the largest number of different promises Manish can give the frogs for the values L and R.
</p>

<p>
You are given the <type>int</type>s <b>Llo</b> and <b>Rhi</b>.
Consider all pairs of integers (L,R) such that <b>Llo</b> &lt;= L &lt; R &lt;= <b>Rhi</b>.
Assume that the pair (L,R) is chosen uniformly at random from all these pairs.
Calculate the expected value of P(L,R).
Represent that value as a reduced fraction X/Y.
Return (X * Y^(-1)) modulo (10^9 + 7).
</p></intro>
        </div>
    </div>
    
    <!-- Problem definition -->
    
    <div class="section" id="definition">
        <h2 class="section-title">Definition</h2>
        <div class="problem-definition">
            <ul class="problem-definition-lines">
                <li class="definition-line" id='class-line'>
                    <span class='definition-name'>Class</span>
                    <span class='definition-value'>ComponentsForever</span>
                </li>
                <li class="definition-line" id='method-line'>
                    <span class='definition-name'>Method</span>
                    <span class='definition-value'>countComponents</span>
                </li>
                <li class="definition-line" id='parameters-line'>
                    <span class='definition-name'>Parameters</span>
                    <span class='definition-value'>
                    
                        int
                    , 
                        vector&lt;int&gt;
                    , 
                        vector&lt;int&gt;
                    , 
                        int
                    , 
                        int
                    , 
                        int
                    , 
                        int
                    , 
                        int
                    
                    </span>
                </li>
                <li class="definition-line" id='returns-line'>
                    <span class='definition-name'>Returns</span>
                    <span class='definition-value'>
                        int
                    </span>
                </li>
                <li class="definition-line" id='signature-line'>
                    <span class='definition-name'>Method signature</span>
                    <span class='definition-value'>
                        int countComponents(int n, vector&lt;int&gt; Xprefix, vector&lt;int&gt; Yprefix, int seed, int Xrange, int Yrange, int Llo, int Rhi)
                    </span>
                </li>
            </ul>
            <div class="problem-definition-public-tip">(be sure your method is public)</div>
        </div>        
    </div>
    

    <!-- Limits -->
    <div class="section">
        <h2 class="section-title">Limits</h2>
        <div class='problem-limits'>
            <ul class="limit-lines">
                <li class='limit-line'>
                    <span class='limit-name'>Time limit (s)</span>
                    <span class='limit-value'>5.000</span>
                </li>
                <li class='limit-line'>
                    <span class='limit-name'>Memory limit (MB)</span>
                    <span class='limit-value'>256</span>
                </li>
            </ul>
        </div>
    </div>

    
    <!-- Notes -->
    <div class="section">
        <h2 class="section-title">Notes</h2>
        <ul class="notes">
        
            <li><note escaped="1">In the definition of the return value, Y^(-1) denotes the inverse element to Y when computing modulo 10^9 + 7. You may assume that for each valid input this value exists.</note></li>
        
        </ul>
    </div>
    
    
    <!-- Constraints -->
    <div class="section">
        <h2 class="section-title">Constraints</h2>
        <ul class="constraints">
        
            <li><user-constraint escaped="1"><b>n</b> will be between 2 and 75,000, inclusive.</user-constraint></li>
        
            <li><user-constraint escaped="1"><b>Xprefix</b> will have between 0 and min(<b>n</b>,200) elements, inclusive.</user-constraint></li>
        
            <li><user-constraint escaped="1"><b>Yprefix</b> will have the same number of elements as <b>Xprefix</b>.</user-constraint></li>
        
            <li><user-constraint escaped="1">Each element of <b>Xprefix</b> and <b>Yprefix</b> will be between 0 and 500,000,000 inclusive.</user-constraint></li>
        
            <li><user-constraint escaped="1"><b>seed</b> will be between 0 and 500,000,000 inclusive.</user-constraint></li>
        
            <li><user-constraint escaped="1"><b>Xrange</b> and <b>Yrange</b> will each be between 1 and 500,000,001 inclusive.</user-constraint></li>
        
            <li><user-constraint escaped="1"><b>Llo</b> and <b>Rhi</b> will satisfy 1 &lt;= <b>Llo</b> &lt; <b>Rhi</b> &lt;= 500,000,000.</user-constraint></li>
        
            <li><user-constraint escaped="1">The input will be such that the locations of the <b>n</b> frogs will all be distinct.</user-constraint></li>
        
        </ul>
    </div>

    <!-- Test cases -->
    <div class="section">
        <h2 class="section-title">Test cases</h2>
        <ol class="testcases" start='0'>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    2
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    { 1, 4 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    { 1, 3 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    5
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            2
                        
                        </span>
                    </div>
                    
                    <div class="testcase-annotation">
                        <div class='tag'>note</div>
                        <div class="testcase-comment">We have two frogs: one at (1, 1) and the other at (4, 3). Regardless of the range of the walkie-talkies, these two frogs cannot communicate. Hence, Manish can always make two distinct promises.</div>
                    </div>
                    
               
                </div>
            </li>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    2
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    { 1, 3 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    { 1, 3 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    5
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            1
                        
                        </span>
                    </div>
                    
                    <div class="testcase-annotation">
                        <div class='tag'>note</div>
                        <div class="testcase-comment">Here we have two frogs located at (1, 1) and (3, 3).
For any pair (L, R) such that 1 &lt;= L &lt; R &lt;= 5, the closed interval [L,R] will contain some value x such that the first frog can get to the other in x hops.
Hence, regardless of the range of walkie-talkies, Manish must always tell both frogs the same promise.</div>
                    </div>
                    
               
                </div>
            </li>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    2
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    { 5, 21232 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    { 6, 123 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    1
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    5132
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            2
                        
                        </span>
                    </div>
                    
                    <div class="testcase-annotation">
                        <div class='tag'>note</div>
                        <div class="testcase-comment">These two frogs are too far from each other, the ranges of walkie-talkies we are interested in are not sufficient to reach from one frog to the other.</div>
                    </div>
                    
               
                </div>
            </li>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    18
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    { 16, 21, 33, 46, 10 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    { 22, 25, 46, 18, 8 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    1253
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    47
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    31
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    12
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    86
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            394234239
                        
                        </span>
                    </div>
                    
                    <div class="testcase-annotation">
                        <div class='tag'>note</div>
                        <div class="testcase-comment">For reference, the full arrays X and Y once you finish generating them should look as follows:
<pre>
X = { 16, 21, 33, 46, 10, 19, 8, 15, 42, 38, 21, 25, 2, 11, 1, 11, 29, 45 }
Y = { 22, 25, 46, 18, 8, 28, 14, 24, 21, 26, 15, 30, 28, 23, 16, 30, 23, 9 }
</pre></div>
                    </div>
                    
               
                </div>
            </li>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    9
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    { 28, 33, 6, 14, 20, 35, 49, 15, 46 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    { 48, 32, 11, 28, 1, 22, 24, 41, 1 }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    1522
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    9
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    35
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    18
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    55
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            512091044
                        
                        </span>
                    </div>
                    
                    <div class="testcase-annotation">
                        <div class='tag'>note</div>
                        <div class="testcase-comment">If the range for the walkie-talkies is [18,19], [18,20], or [19,20], Manish will be able to make four different promises. In each of the 700 other valid scenarios Manish can only make two different promises. Thus, the expected number of promises is (3*4 + 700*2) / 703 =</div>
                    </div>
                    
               
                </div>
            </li>
            
            <li class="testcase">
                <div class="testcase-content">
                    <div class="testcase-input">
                        <div class='tag'>input</div>
                        <ul class="variables">
                        
                            <li class="variable data">
                                <span class="name data">n</span>
                                <span class="value data">
                                
                                    70874
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xprefix</span>
                                <span class="value data">
                                
                                    {  }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yprefix</span>
                                <span class="value data">
                                
                                    {  }
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">seed</span>
                                <span class="value data">
                                
                                    477403840
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Xrange</span>
                                <span class="value data">
                                
                                    153268855
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Yrange</span>
                                <span class="value data">
                                
                                    153409203
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Llo</span>
                                <span class="value data">
                                
                                    523210
                                
                                </span>
                            </li>
                        
                            <li class="variable data">
                                <span class="name data">Rhi</span>
                                <span class="value data">
                                
                                    465494481
                                
                                </span>
                            </li>
                        
                        </ul>
                    </div>
                    <div class="testcase-output">
                        <div class='tag'>output</div>
                        <span class="prefix data">Returns</span>
                        <span class="value data">
                        
                            248460139
                        
                        </span>
                    </div>
                    
               
                </div>
            </li>
            
        </ol>
    </div>
    <hr />

    This problem statement is the exclusive and proprietary property of TopCoder, Inc. Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited. (c)2003, TopCoder, Inc. All rights reserved.
</body>
</html>
